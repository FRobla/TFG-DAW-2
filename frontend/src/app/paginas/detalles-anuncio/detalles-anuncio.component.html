<!-- Navbar -->
<app-navbar-busqueda></app-navbar-busqueda>

<!-- Contenedor principal -->
<div class="main-container">
  <!-- Migas de pan -->
  <section class="breadcrumb-section">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="#">Inicio</a></li>
          <li class="breadcrumb-item"><a href="javascript:void(0)" (click)="volverAResultados($event)">Resultados de búsqueda</a></li>
          <li class="breadcrumb-item active" aria-current="page" [attr.data-view-id]="'anuncio-title-' + anuncioId" data-view-transition="header">{{anuncio.titulo}}</li>
        </ol>
      </nav>
    </div>
  </section>

  <!-- Spinner de carga mientras se obtienen los datos -->
  <div class="container" *ngIf="cargando">
    <div class="loading-container">
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Contenido del anuncio (visible solo cuando se han cargado los datos) -->
  <div class="container" *ngIf="!cargando" data-view-transition="card">
    <div class="row mt-4">
      <!-- Columna izquierda: Información del servicio -->
      <div class="col-lg-8">
        <div class="detail-card">
          <!-- Titulo y categoría -->
          <div class="service-badge" *ngIf="anuncioId === 1 || anuncioId === 5">Popular</div>
          <div class="service-badge" *ngIf="anuncioId === 2">Rápido</div>
          <div class="service-badge" *ngIf="anuncioId === 3">Eco</div>
          <div class="service-badge" *ngIf="anuncioId === 7">Oferta</div>
          <div class="service-badge" *ngIf="anuncioId === 9">Nuevo</div>
          
          <div class="title-container">
            <h1 data-view-transition="header" [attr.data-view-id]="'anuncio-title-' + anuncioId">{{anuncio.titulo}}</h1>
            
            <!-- Botón de favoritos -->
            <button class="btn-favorite" 
                    [class.active]="esFavorito" 
                    [disabled]="cargandoFavorito"
                    (click)="toggleFavorito()"
                    [title]="esFavorito ? 'Eliminar de favoritos' : 'Añadir a favoritos'">
              <i *ngIf="!cargandoFavorito && !esFavorito" class="bi bi-heart"></i>
              <i *ngIf="!cargandoFavorito && esFavorito" class="bi bi-heart-fill"></i>
              <i *ngIf="cargandoFavorito" class="bi bi-arrow-repeat spinning"></i>
            </button>
          </div>
          
          <!-- Información del proveedor y valoración -->
          <div class="service-provider">
            <div class="provider-info">
              <div class="provider-avatar">
                {{anuncio.proveedor.charAt(0)}}
              </div>
              <div>
                <span class="provider-name">{{anuncio.proveedor}}</span>
                <div class="d-flex align-items-center mt-1">
                  <i class="bi bi-geo-alt-fill me-1"></i>
                  <span>{{anuncio.ubicacion}}</span>
                </div>
              </div>
            </div>
            <div>
              <div class="rating">
                <span *ngIf="anuncio.valoracion === 5">★★★★★</span>
                <span *ngIf="anuncio.valoracion === 4">★★★★☆</span>
                <span *ngIf="anuncio.valoracion === 3">★★★☆☆</span>
                <span class="rating-count">({{anuncio.numValoraciones}})</span>
              </div>
            </div>
          </div>
          
          <!-- Imagen principal del servicio -->
          <div class="service-image-container mt-4" data-view-transition="image" [attr.data-view-id]="'anuncio-img-' + anuncioId">
            <!-- Imagen placeholder SVG según tipo de servicio -->
            <svg *ngIf="anuncioId === 1" viewBox="0 0 100 100" width="150" height="150">
              <rect x="20" y="20" width="60" height="60" fill="none" stroke="#FFFFFF" stroke-width="2"/>
              <path d="M30,50 L70,50 M50,30 L50,70" stroke="#FFFFFF" stroke-width="2"/>
            </svg>
            <svg *ngIf="anuncioId === 2" viewBox="0 0 100 100" width="150" height="150">
              <path d="M30,70 L50,30 L70,70 Z" fill="none" stroke="#FFFFFF" stroke-width="2"/>
            </svg>
            <svg *ngIf="anuncioId === 3" viewBox="0 0 100 100" width="150" height="150">
              <circle cx="50" cy="50" r="30" fill="none" stroke="#FFFFFF" stroke-width="2"/>
              <path d="M50,30 L50,50 L65,65" stroke="#FFFFFF" stroke-width="2"/>
            </svg>
            <svg *ngIf="anuncioId === 4" viewBox="0 0 100 100" width="150" height="150">
              <path d="M30,50 C30,30 70,30 70,50 C70,70 30,70 30,50 Z" fill="none" stroke="#FFFFFF" stroke-width="2"/>
              <circle cx="50" cy="50" r="10" fill="none" stroke="#FFFFFF" stroke-width="2"/>
            </svg>
            <svg *ngIf="anuncioId === 5" viewBox="0 0 100 100" width="150" height="150">
              <rect x="25" y="25" width="50" height="50" rx="5" fill="none" stroke="#FFFFFF" stroke-width="2"/>
              <circle cx="50" cy="50" r="15" fill="none" stroke="#FFFFFF" stroke-width="2"/>
            </svg>
            <svg *ngIf="anuncioId === 6" viewBox="0 0 100 100" width="150" height="150">
              <path d="M20,80 L50,20 L80,80 Z" fill="none" stroke="#FFFFFF" stroke-width="2"/>
              <path d="M35,80 L50,50 L65,80 Z" fill="none" stroke="#FFFFFF" stroke-width="2"/>
            </svg>
            <svg *ngIf="anuncioId === 7" viewBox="0 0 100 100" width="150" height="150">
              <circle cx="50" cy="50" r="30" fill="none" stroke="#FFFFFF" stroke-width="2"/>
              <rect x="35" y="35" width="30" height="30" fill="none" stroke="#FFFFFF" stroke-width="2"/>
            </svg>
            <svg *ngIf="anuncioId === 8" viewBox="0 0 100 100" width="150" height="150">
              <path d="M20,50 C20,30 80,30 80,50 C80,70 20,70 20,50 Z" fill="none" stroke="#FFFFFF" stroke-width="2"/>
              <line x1="20" y1="50" x2="80" y2="50" stroke="#FFFFFF" stroke-width="2"/>
            </svg>
            <svg *ngIf="anuncioId === 9" viewBox="0 0 100 100" width="150" height="150">
              <polygon points="50,20 80,50 50,80 20,50" fill="none" stroke="#FFFFFF" stroke-width="2"/>
              <circle cx="50" cy="50" r="15" fill="none" stroke="#FFFFFF" stroke-width="2"/>
            </svg>
            <svg *ngIf="anuncioId < 1 || anuncioId > 9" viewBox="0 0 100 100" width="150" height="150">
              <rect x="20" y="20" width="60" height="60" fill="none" stroke="#FFFFFF" stroke-width="2"/>
            </svg>
          </div>
          
          <!-- Descripción del servicio -->
          <div class="mt-4">
            <h3>Descripción</h3>
            <p>{{anuncio.descripcion}}</p>
            <p>{{anuncio.descripcionLarga}}</p>
          </div>
          
          <!-- Especificaciones técnicas -->
          <div class="mt-5">
            <h3>Especificaciones</h3>
            <table class="specs-table">
              <tbody>
                <tr>
                  <th>Tiempo de entrega</th>
                  <td>{{anuncio.tiempoEntrega}}</td>
                </tr>
                <tr>
                  <th>Materiales disponibles</th>
                  <td>{{anuncio.materiales.join(', ')}}</td>
                </tr>
                <tr>
                  <th>Colores disponibles</th>
                  <td>{{anuncio.colores.join(', ')}}</td>
                </tr>
                <tr>
                  <th>Tamaño máximo</th>
                  <td>{{anuncio.tamanoMaximo}}</td>
                </tr>
                <tr>
                  <th>Métodos de pago</th>
                  <td>{{anuncio.metodoPago}}</td>
                </tr>
                <tr>
                  <th>Política de cancelación</th>
                  <td>{{anuncio.politicasCancelacion}}</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Sección de valoraciones -->
          <div class="reviews-section">
            <h3>Valoraciones y Opiniones</h3>
            <div class="rating mb-3">
              <span *ngIf="anuncio.valoracion === 5">★★★★★</span>
              <span *ngIf="anuncio.valoracion === 4">★★★★☆</span>
              <span *ngIf="anuncio.valoracion === 3">★★★☆☆</span>
              <span class="rating-count">({{anuncio.numValoraciones}} valoraciones)</span>
            </div>
            
            <!-- Listado de valoraciones -->
            <div *ngFor="let valoracion of valoraciones" class="review-card">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar">
                    {{valoracion.nombre.charAt(0)}}
                  </div>
                  <div>
                    <div class="reviewer-name">{{valoracion.nombre}}</div>
                    <div class="review-date">{{valoracion.fecha | date:'dd/MM/yyyy'}}</div>
                  </div>
                </div>
                <div class="review-rating">
                  <span *ngIf="valoracion.estrellas === 5">★★★★★</span>
                  <span *ngIf="valoracion.estrellas === 4">★★★★☆</span>
                  <span *ngIf="valoracion.estrellas === 3">★★★☆☆</span>
                </div>
              </div>
              <div class="review-content">
                {{valoracion.comentario}}
              </div>
              
              <!-- Respuesta del proveedor (si existe) -->
              <div *ngIf="valoracion.respuesta" class="review-response">
                <div class="response-header">
                  Respuesta del proveedor:
                </div>
                <div class="response-content">
                  {{valoracion.respuesta.texto}}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Columna derecha: Panel de opciones y compra -->
      <div class="col-lg-4">
        <div class="detail-card options-container">
          <h3>Personalizar servicio</h3>
          
          <!-- Selección de material -->
          <div class="option-group">
            <label class="option-label">Material:</label>
            <div class="option-chips">
              <div *ngFor="let material of anuncio.materiales" 
                   class="option-chip" 
                   [class.active]="materialSeleccionado === material"
                   (click)="actualizarMaterial(material)">
                {{material}}
              </div>
            </div>
          </div>
          
          <!-- Control de cantidad -->
          <div class="option-group">
            <label class="option-label">Cantidad:</label>
            <div class="quantity-control">
              <button class="quantity-btn" (click)="actualizarCantidad(cantidad - 1)" [disabled]="cantidad <= 1">-</button>
              <input type="number" class="quantity-input" [(ngModel)]="cantidad" min="1" max="100" (change)="calcularPrecio()">
              <button class="quantity-btn" (click)="actualizarCantidad(cantidad + 1)" [disabled]="cantidad >= 100">+</button>
            </div>
          </div>
          
          <!-- Servicios adicionales -->
          <div class="option-group">
            <label class="option-label">Servicios adicionales:</label>
            <div *ngFor="let servicio of anuncio.serviciosAdicionales" 
                 class="additional-service"
                 [class.active]="serviciosAdicionales[servicio.id]"
                 (click)="toggleServicioAdicional(servicio.id)">
              <input type="checkbox" class="service-checkbox" 
                     [checked]="serviciosAdicionales[servicio.id]"
                     (click)="$event.stopPropagation();"
                     (change)="toggleServicioAdicional(servicio.id)">
              <div class="service-info">
                <div class="service-name">{{servicio.nombre}}</div>
                <div class="service-description">{{servicio.descripcion}}</div>
              </div>
              <div class="service-price">+{{servicio.precio}}€</div>
            </div>
          </div>
          
          <!-- Resumen de precio -->
          <div class="price-summary mt-4">
            <div class="price-row">
              <div class="price-label">Precio base</div>
              <div class="price-value">{{precioBase}}€</div>
            </div>
            <div class="price-row" *ngIf="cantidad > 1">
              <div class="price-label">Cantidad</div>
              <div class="price-value">x{{cantidad}}</div>
            </div>
            <div class="price-row" *ngFor="let servicio of anuncio.serviciosAdicionales">
              <div class="price-label" *ngIf="serviciosAdicionales[servicio.id]">{{servicio.nombre}}</div>
              <div class="price-value" *ngIf="serviciosAdicionales[servicio.id]">+{{servicio.precio}}€</div>
            </div>
            <hr>
            <div class="price-row">
              <div class="price-label">Total</div>
              <div class="price-total">{{precioTotal}}€</div>
            </div>
          </div>
          
          <!-- Botones de acción -->
          <div class="mt-4">
            <button class="btn btn-cta w-100 mb-3" (click)="anadirAlCarrito()">
              <i class="bi bi-cart-plus me-2"></i> Añadir al carrito
            </button>
            <button class="btn btn-outline w-100" (click)="contactarProveedor()">
              <i class="bi bi-chat-dots me-2"></i> Contactar con el proveedor
            </button>
          </div>
          
          <!-- Volver a resultados -->
          <div class="text-center mt-4">
            <a href="javascript:void(0)" (click)="volver()" class="text-info">
              <i class="bi bi-arrow-left me-1"></i> Volver a resultados
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<app-footer></app-footer>
