<div class="dashboard-container">
  <app-navbar-admin (busquedaChange)="aplicarFiltro($event)" (exportarUsuariosEvent)="exportarCategorias()"></app-navbar-admin>

  <div class="dashboard-stats">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-tags"></i>
      </div>
      <div class="stat-info">
        <h3 class="stat-number">{{categorias.length}}</h3>
        <p class="stat-label">Total Categorías</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-th-large"></i>
      </div>
      <div class="stat-info">
        <h3 class="stat-number">{{categorias.length > 0 ? categorias.length : 0}}</h3>
        <p class="stat-label">Categorías Activas</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-cogs"></i>
      </div>
      <div class="stat-info">
        <h3 class="stat-number">{{categorias.length > 0 ? categorias.length * 2 : 0}}</h3>
        <p class="stat-label">Servicios Asociados</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-calendar-alt"></i>
      </div>
      <div class="stat-info">
        <h3 class="stat-number">{{getCategoriasRecientes()}}</h3>
        <p class="stat-label">Añadidas Recientemente</p>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <div class="table-container">
      <table class="categorias-table">
        <thead>
          <tr>
            <th class="text-center underline">ID</th>
            <th class="text-center underline">Ícono</th>
            <th class="text-center underline">Nombre</th>
            <th class="text-center underline">Descripción</th>
            <th class="text-center underline">Servicios</th>
            <th class="text-center underline">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let categoria of categoriasFiltradas">
            <td class="cat-id" data-label="ID">{{categoria.id}}</td>
            <td class="cat-icon" data-label="Ícono">
              <div class="cat-icon-container">
                <i class="fas fa-tag"></i>
              </div>
            </td>
            <td class="cat-name" data-label="Nombre">
              <span class="nombre">{{categoria.nombre}}</span>
            </td>
            <td class="cat-description" data-label="Descripción">
              <span class="descripcion">{{categoria.descripcion}}</span>
            </td>
            <td class="cat-services" data-label="Servicios">
              <button class="services-btn" (click)="verServiciosCategoria(categoria)">
                <i class="fas fa-search"></i> Ver servicios
              </button>
            </td>
            <td class="cat-actions" data-label="Acciones">
              <button class="action-btn edit-btn" (click)="editarCategoria(categoria)" title="Editar">
                <i class="fas fa-edit"></i>
              </button>
              <button class="action-btn delete-btn" (click)="confirmarEliminar(categoria)" title="Eliminar">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="categoriasFiltradas.length === 0" class="no-results">
      <div class="no-results-content">
        <i class="fas fa-search no-results-icon"></i>
        <h3>No se encontraron categorías</h3>
        <p>Intenta con otra búsqueda o crea una nueva categoría</p>
      </div>
    </div>
  </div>

  <div class="pagination-container" *ngIf="categorias.length > itemsPorPagina">
    <div class="pagination">
      <button class="pagination-btn" [disabled]="paginaActual === 1" (click)="cambiarPagina(paginaActual - 1)">
        <i class="fas fa-chevron-left"></i>
      </button>
      <span class="pagination-info">Página {{paginaActual}} de {{totalPaginas}}</span>
      <button class="pagination-btn" [disabled]="paginaActual === totalPaginas" (click)="cambiarPagina(paginaActual + 1)">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
    <div class="pagination-select">
      <select [(ngModel)]="itemsPorPagina" (change)="cambiarItemsPorPagina()">
        <option [value]="5">5 por página</option>
        <option [value]="10">10 por página</option>
        <option [value]="20">20 por página</option>
        <option [value]="50">50 por página</option>
      </select>
    </div>
  </div>

  <div class="dashboard-actions">
    <button class="btn btn-danger" (click)="confirmarEliminarTodos()">
      <i class="fas fa-trash-alt"></i> Eliminar Todas
    </button>
    <button class="btn btn-export" (click)="abrirModalCrearCategoria()">
      <i class="fas fa-plus"></i> Nueva Categoría
    </button>
  </div>
</div>

<!-- Modal para crear/editar categoría -->
<div class="modal" [class.active]="modalVisible">
  <div class="modal-content">
    <div class="modal-header">
      <h2>{{modoEdicion ? 'Editar Categoría' : 'Crear Nueva Categoría'}}</h2>
      <button class="close-btn" (click)="cerrarModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form #categoriaForm="ngForm">
        <div class="form-group">
          <label for="nombre">Nombre</label>
          <input type="text" id="nombre" name="nombre" [(ngModel)]="categoriaActual.nombre" required>
        </div>
        <div class="form-group">
          <label for="descripcion">Descripción</label>
          <textarea id="descripcion" name="descripcion" [(ngModel)]="categoriaActual.descripcion" rows="4" required></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-cancel" (click)="cerrarModal()">Cancelar</button>
      <button class="btn btn-save btn-outline-light btn-lg" [disabled]="!categoriaForm.valid" (click)="guardarCategoria()">
        {{modoEdicion ? 'Actualizar' : 'Crear'}}
      </button>
    </div>
  </div>
</div>

<!-- Modal de confirmación -->
<div class="confirmacion-modal" [class.active]="modalConfirmacionVisible">
  <div class="confirmacion-content">
    <div class="confirmacion-icon">
      <i class="fas fa-exclamation-triangle"></i>
    </div>
    <h2 class="confirmacion-titulo">{{tituloConfirmacion}}</h2>
    <p class="confirmacion-mensaje">{{mensajeConfirmacion}}</p>
    <div class="confirmacion-acciones">
      <button class="btn btn-cancel" (click)="modalConfirmacionVisible = false">Cancelar</button>
      <button class="btn btn-confirmar" (click)="ejecutarAccionConfirmacion()">Confirmar</button>
    </div>
  </div>
</div>